
pipeline {
    agent any
    
    environment {
        // Define AWS EC2 IP/DNS and user credentials
        NGINX_NODE = 'your-ec2-public-ip-or-dns'
        EC2_USER = 'ec2-user' // default for Amazon Linux, change if using other OS
        SSH_KEY_ID = 'your-jenkins-ssh-key-credential-id'  // SSH Key stored in Jenkins Credentials
    }
    
    stages {
        stage('Install NGINX on EC2') {
            steps {
                script {
                    // Connect to EC2 and install NGINX using SSH
                    sshagent([SSH_KEY_ID]) {
                        sh """
                            echo "Connecting to Nginx instance and installing NGINX"
                            ssh -o StrictHostKeyChecking=no ${EC2_USER}@${EC2_HOST} << 'EOF'
                                sudo yum update -y           # Update system (Amazon Linux)
                                sudo amazon-linux-extras enable nginx1.12  # Enable NGINX
                                sudo yum install -y nginx      # Install NGINX
                                sudo systemctl start nginx     # Start NGINX service
                                sudo systemctl enable nginx    # Enable NGINX on boot
                            EOF
                        """
                    }
                }
            }
        }
    }
    
    post {
        success {
            echo "NGINX installation on EC2 was successful!"
        }
        failure {
            echo "NGINX installation on EC2 failed!"
        }
    }
}